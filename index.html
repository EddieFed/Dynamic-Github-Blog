<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Blog!</title>

    <script src="post.js"></script>

    <script>
        function loadPage() {
            fetch("https://api.github.com/repos/EddieFed/Dynamic-Github-Blog/contents/posts.json")
                .then(r => r.json())
                .then(function(d) {
                    const oldPostContentDecoded = JSON.parse(atob(d.content));
                    console.log("Old Post Decoded: " + JSON.stringify(oldPostContentDecoded));

                    let posts = document.getElementById("posts");

                    // Must empty the DOM any time there is a new post added
                    while (posts.hasChildNodes()) {
                        posts.removeChild(posts.firstChild);
                    }

                    oldPostContentDecoded.articles.forEach((article) => {

                        // TODO
                        // Make so links to pages generate instead of full thing

                        let post = document.createElement("DIV");
                        let title = document.createElement("A");
                        // let body = document.createElement("P");
                        // let date = document.createElement("P");
                        let br = document.createElement("BR");

                        title.innerText = article.title;
                        title.href = "/articles/" + article.title.replace(" ", "-");
                        // body.innerText = article.body;
                        // date.innerText = article.date;

                        post.appendChild(title);
                        // post.appendChild(body);
                        // post.appendChild(date);
                        post.appendChild(br);
                        posts.appendChild(post);
                    })

                });
        }
    </script>

</head>
<body onload="loadPage()">

    <label>
        <textarea rows="1" cols="150" placeholder="Add a Title!" id="title"></textarea>
    </label>
    <br>
    <label>
        <textarea rows="20" cols="150" placeholder="Type Your Article Here!" id="article"></textarea>
    </label>
    <br>
    <label>
        <textarea rows="1" cols="150" placeholder="API Token!" id="token"></textarea>
    </label>
    <br>
    <button onclick="init()">Post!</button>
    <br>
    <br>
    <br>
    <div id="posts">

    </div>

</body>
</html>