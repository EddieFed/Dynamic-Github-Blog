<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Blog!</title>
    <script>
        function load() {
            const url = window.location.href;

            // TODO
            // Switch when committing
            const title = url.substring(url.indexOf("articles/") + 9).replace(/-/g, " ");
            // const title = url.substring(url.indexOf("404.html?") + 9).replace(/-/g, " ");

            console.log(title);

            fetch("https://api.github.com/repos/EddieFed/Dynamic-Github-Blog/contents/posts.json")
                .then(r => r.json())
                .then(function(d) {
                    const data = JSON.parse(atob(d.content));

                    let articles = data["articles"];
                    console.log(articles[0]);

                    articles.forEach((article) => {
                        if(title === article.title) {
                            console.log("Match!");
                            let post = document.createElement("DIV");
                            let title = document.createElement("P");
                            let body = document.createElement("P");
                            let date = document.createElement("P");
                            let br = document.createElement("BR");

                            title.innerText = article["title"];
                            body.innerText = article["body"];
                            date.innerText = article["date"];

                            post.appendChild(title);
                            post.appendChild(body);
                            post.appendChild(date);
                            post.appendChild(br);
                            posts.appendChild(post);
                        }
                    });

                });

        }
    </script>
</head>
<body onload="load()">

    <div id="posts">
        <!--    Dynamically filled    -->
    </div>

</body>
</html>